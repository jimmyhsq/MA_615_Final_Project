---
title: "Shuoqi Huang Final Project"
author: "Shuoqi Huang"
date: "12/16/2019"
output: ioslides_presentation
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,dev="png",fig.align  = 'center')
pacman::p_load(ggplot2,knitr,arm,data.table,foreign,gridExtra,car,stringr,rstanarm,tidyverse,dplyr, plyr, leaflet,tidytext, tm, wordcloud, wordcloud2,htmltools, plotly,webshot,htmlwidgets,rgdal,sp,mapview, ggmap)
```


## Introduction    
I would like to explore a research question that explores Airbnb in Boston. To be more specific, I am wondering what factors affect the price of Airbnb. Do numbers of bedrooms, types of room, and scores of satisfaction affect the price?  Moreover, does a neighborhood with high crime rate cause lower prices on Airbnb? I will also combine data, such as crime incident reports to analyze whether these factors influence the price of Airbnb.     
 

```{r,echo=FALSE, warning=F, include=F}
## Load three forms of data
# Airbnb data 
airbnb_boston <- read_csv("tomslee_airbnb_boston_1429_2017-07-10.csv")

# Text data of Airbnb 
text_data <- read_csv("Text.csv")
clean_text_data <- text_data%>% dplyr::filter(number_of_reviews > 50)

# Crime incidents data 
crime <- read_csv("Crime.csv")
crime_2017 <- crime %>% dplyr::filter( YEAR == 2017 & OFFENSE_CODE_GROUP %in% c('HOME INVASION', 'Property Lost','Robbery'))
crime_2017 <- crime_2017 %>% dplyr::filter(!INCIDENT_NUMBER %in% c('I182015290', 'I172103170', 'I172098101', 'I172092567', 'I172049551') )
write.csv(crime_2017,file= "crime_2017.csv",row.names=FALSE)

## Filter number of reviews that is greater than 50.
Clean_airbnb_boston <- airbnb_boston %>% dplyr::filter(reviews > 50)
write.csv(Clean_airbnb_boston, file = "Clean_airbnb_boston.csv",row.names=FALSE)

```

## Exploratory data analysis           
### A. Distribution of price in Boston area.        
```{r, echo = FALSE}

## Let us see how many neighborhoods does this data include? 
Clean_airbnb_boston$neighborhood <- as.factor(Clean_airbnb_boston$neighborhood)

plot_jitter <- ggplot(data  = Clean_airbnb_boston, aes(x = neighborhood, y = price, col = neighborhood),)+
  geom_point(size = 1.2, alpha = .8)+
  geom_jitter()+
  labs(x = "Neighborhood", y = "Price", title = "Neighborhood vs. Price")+
  theme_bw()+ theme(axis.text.x = element_text(angle = 45, hjust  = 1),legend.position = "none")
plot_jitter 

```

## Countinue - Distribution of price in Boston area.  
```{r, echo = F}
## Let us see the distribution of price in Boston area.
plot_price <- ggplot(data = Clean_airbnb_boston, aes(x =price, fill = neighborhood) )+
  geom_density(alpha= 0.5, show.legend = FALSE)+
  labs( x = "Price", title = "Distribution of price in in Boston area")+ 
  theme_bw()
ggplotly(plot_price)

```

## Interpretation:      
We can see from the first plot that the neighborhood Jamaica Plain has the highest price that is around 600 dollars. Then, South Boston has the second high prices. Most of Airbnb has the price range from 50 to 300 dollars per night. We can see the distribution of each neighborhood in the second plot. Moreover, we can select the neighborhood to see the distribution. Take Fenway as an example, most of Airbnb has the price from 100 to 200 dollars per night.         


## B. Number of bedrooms vs. Price          
```{r, echo = F }
##Create box plot
box_1 <- ggplot( Clean_airbnb_boston, aes(x= bedrooms , y=price, group = bedrooms, color = factor(bedrooms))) + 
  geom_boxplot(show.legend = FALSE) +
  labs( title = "Box plot of bedrooms and price", x = "Number of bedrooms", y = "Price", color = "Number of bedrooms")+
  theme_bw() 
box_1
```

##

```{r, echo=F}
ggplot(Clean_airbnb_boston, aes(x= bedrooms, y=price)) + 
  geom_point()+
  geom_smooth(method=lm)+
  labs( title = "Linear regression of bedrooms and price", x = "Number of bedrooms", y = "Price", color = "Number of bedrooms")+
  theme_bw()
```
     
## Interpretation:          
We can see from the previous graph that the median of rooms with different numbers of bedrooms differs a lot. This means numbers of bedrooms affect the price of Airbnb in the Boston area. The price on airbnb increases when the number of bedrooms increases.       
 
 
 
## C. Room type vs. Price           
```{r, echo = F}
##Create box plot
box_2 <- ggplot(Clean_airbnb_boston, aes(x= room_type, y=price, group = room_type , color = factor(room_type))) +      geom_boxplot(show.legend = FALSE)+ 
  labs( title = "Box plot of room type and price ", x = "Room type", y = "Price", color = "Room type")+ 
  theme_bw() 
box_2
```
            
## Interpretation:       
The entire room/apt has the highest price. The prices between private rooms and shared rooms change a little by observing the previous graph. Moreover, the most popular type of room in the Boston area is the entire home/apt.         

## D. Overall satisfaction vs. Price         
```{r, echo= F}
##Create box plot
box_3 <- ggplot( Clean_airbnb_boston, aes(x=overall_satisfaction, y= price, group = overall_satisfaction , color =factor(overall_satisfaction))) + 
  geom_boxplot(show.legend = FALSE) +
  labs( title = "Box plot of satisfaction and price", x = "Overall satisfaction", y = "Price", color = "Overall satisfaction")+ 
  theme_bw()

box_3
```
     
## Interpretation:    

The score of satisfaction has little affect on the price. We can see that median of different scores of satisfaction are almost the same.    




## Text analysis                 
### A. Text analysis on description on Airbnb         
```{r, echo = F , warning= F}
## Build corpus 
description_text  <- iconv(clean_text_data$description, to = "utf-8-mac")
description_text  <- Corpus(VectorSource(description_text))


## Clean text 
## Change all letters to lowercase
description_text <- tm_map(description_text,tolower)
## remove Punctuation
description_text <- tm_map(description_text,removePunctuation)
## remove numbers
description_text <- tm_map(description_text,removeNumbers)
## Remove unnecessary words 
Clean_description <- tm_map(description_text, removeWords, stopwords('english'))


Clean_description <- tm_map(Clean_description, removeWords,c('boston','room', 'located','also','can','just','well','will'))

Clean_description <- tm_map(Clean_description, stripWhitespace)

tdm_description <- TermDocumentMatrix(Clean_description)
tdm_description <- as.matrix(tdm_description)


count_tdm <- rowSums(tdm_description)
count_tdm <- subset(count_tdm, count_tdm>= 150)

## Word Cloud 
Word_c <-  sort(count_tdm, decreasing = T)
## set.seed(200)
## wordcloud(words = names(Word_c), 
        ## freq =  Word_c,
         ##random.order = F, 
        ## colors = brewer.pal(8, 'Dark2'), 
         ##scale = c(5,0.3), 
        ## )

## Word Cloud2 
Word2_c <- data.frame(names(Word_c), Word_c)
colnames(Word2_c) <- c('word','freq')
plot_2 <- wordcloud2(Word2_c,
           size = 0.5,
           shape = 'circle',
          )
plot_2

## saveWidget(plot_2, "tmp.html", selfcontained = F)
 ##webshot::install_phantomjs()
##webshot("tmp.html", "wc1.png", delay = 5, vwidth = 1000, vheight = 1000)
```
      

## Interpretation:       

I explore the description of housings on Airbnb and do the text analysis about the description. The most frequent word is apartment. Then, the word kitchen is the second. I can check the number of each word by clicking the word. Moreover, we can see private, restaurants, neighborhood from the description on Airbnb.     

## B. Text analysis on Space on Airbnb      
```{r, echo = F, warning= F}

## Build corpus 
space_text  <- iconv(clean_text_data$space, to = "utf-8-mac")
space_text  <- Corpus(VectorSource(space_text))


## Clean text 
## Change all letters to lowercase
space_text <- tm_map(space_text,tolower)
## remove Punctuation
space_text <- tm_map(space_text,removePunctuation)
## remove numbers
space_text <- tm_map(space_text,removeNumbers)
## Remove unnecessary words 
Clean_space <- tm_map(space_text, removeWords, stopwords('english'))
Clean_space <- tm_map(Clean_space, removeWords, c('also', 'apartment','away','great', 'make','day', 'two','room','bedroom','boston','can','located','will','well', 'use','one'))

Clean_space <- tm_map(Clean_space, stripWhitespace)

tdm_space <- TermDocumentMatrix(Clean_space)
tdm_space <- as.matrix(tdm_space)

count_tdm_space <- rowSums(tdm_space)
count_tdm_space <- subset(count_tdm_space, count_tdm_space>= 40 & count_tdm_space <= 180)

Word_c_space <-  sort(count_tdm_space, decreasing = T)
Word2_c_space <- data.frame(names(Word_c_space), Word_c_space)
colnames(Word2_c_space) <- c('word','freq')
 wordcloud2(Word2_c_space,
           size = 0.5,
           shape = 'circle',
          )

##saveWidget(plot_3, "tmp.html", selfcontained = F)
##webshot("tmp.html", "wc2.png", delay = 5, vwidth = 1000, vheight = 1000)
```

           
## Interpretation:       
I also do the text analysis on the space of housings on Airbnb. The result is shown before. The most people care about words like large, new, and comfortable. 



## C. Text analysis on Transit on Airbnb      
```{r, echo= F, warning= F }
## Build corpus 
transit_text  <- iconv(clean_text_data$transit, to = "utf-8-mac")
transit_text  <- Corpus(VectorSource(transit_text))


## Clean text 
## Change all letters to lowercase
transit_text <- tm_map(transit_text,tolower)
## remove Punctuation
transit_text <- tm_map(transit_text,removePunctuation)
## remove numbers
transit_text <- tm_map(transit_text,removeNumbers)
## Remove unnecessary words 
Clean_transit <- tm_map(transit_text, removeWords, stopwords('english'))
Clean_transit <- tm_map(Clean_transit, removeWords, c('also', 'apartment','away','great', 'make','day', 'two','room','bedroom','boston','can','located','will','well', 'use','one', 'get'))

Clean_transit <- tm_map(Clean_transit, stripWhitespace)

tdm_transit <- TermDocumentMatrix(Clean_transit)
tdm_transit <- as.matrix(tdm_transit)

count_tdm_transit <- rowSums(tdm_transit)
count_tdm_transit<- subset(count_tdm_transit, count_tdm_transit>= 80) 

Word_c_transit <-  sort(count_tdm_transit, decreasing = T)
Word2_c_transit <- data.frame(names(Word_c_transit), Word_c_transit)
colnames(Word2_c_transit) <- c('word','freq')

wordcloud2(Word2_c_transit,
           size = 0.5,
           shape = 'circle',
          )

## saveWidget(plot_4, "tmp.html", selfcontained = F)
## webshot("tmp.html", "wc3.png", delay = 5, vwidth = 1000, vheight = 1000)
```
     
## Interpretation:        
Let us see the result of text analysis on transportation on Airbnb. Words like walk, station, and line appear frequently. People are more interested in housings that are closed to public transportations. 


## Map analysis          
### A. Crime  in Boston area         
```{r out.width='100%', echo = F, warning= F, message= F}
## Import package from analyze Boston to create neighborhood information 
bos_neigh <- readOGR("./Boston_Neighborhoods/", layer="Boston_Neighborhoods",verbose = FALSE)
bos_neigh <- spTransform(bos_neigh, CRS("+proj=longlat +datum=WGS84"))
neigh_plot <- fortify(bos_neigh)

## Have to have Google API keys to access ggmap()
## Insert my API key here (I provided the key on Blackboard submission)
register_google(key="my API key")

## Create a map 
b <- ggmap(get_googlemap( center = c(lon = -71.070224, lat = 42.348488), 
                         zoom = 12 ,
                         maptype ='terrain', 
                         color = 'color'))

## Add polygon
b  + geom_polygon(data=neigh_plot, aes(x=long, y=lat, group= group), 
                   alpha=0.3, color="black", fill='green') + 
                   ggtitle("Boston")+
  geom_point(aes(x=Long, y=Lat), data=crime_2017, size=1.5, alpha=0.2, color="black")+
  ggtitle("Boston Crime Report")


```


     
## Interpretation:     
Here is crime incidents map in Boston in 2017. The black dot is the place where the incident took place. We can see that there were many incidents in Downtown, Roxbury, and Dorchester areas. I will combine this map with price distribution to explore the question that does a neighborhood with high crime rate cause lower prices on Airbnb? 


    
## B. Price and crime distribution in the Boston area
```{r out.width='100%', echo = F, warning= F}
## Map of airbnb 
## Get data 
map_price <- Clean_airbnb_boston
map_price$priceo <- cut(Clean_airbnb_boston$price, 
                                 breaks = c(1,100,200,300,400,500,600),right = F, 
                                 labels = c("Price[1,100)", "Price[100,200)", "Price[200,300)", "Price[300,400)", "Price[400,500)", "Price[500,600)"))
 
pal <- colorFactor(palette = c("blue", "green", "yellow", "orange", "red", "maroon"), 
                    domain = map_price$priceo) 
## Create a map 
leaflet(data = map_price) %>% 
  addProviderTiles(providers$Esri.NatGeoWorldMap)%>%
  addCircleMarkers(lng = ~ longitude, lat = ~ latitude,
            color = ~ pal(priceo),
            label = paste("Price = $", Clean_airbnb_boston$price,
                          "Location = ", Clean_airbnb_boston$neighborhood), 
            clusterOptions = markerClusterOptions()
            )%>%
  addLegend(position = "bottomright", 
            pal = pal, 
            values =  ~ priceo,
            title = "Price")%>%
  addCircles(lng = crime_2017$Long,lat = crime_2017$Lat, color = "black")
``` 

    
## Interpretation:             
Here is an interactive map that we can visually explore the relationship between price and number of crimes in the Boston area. I found that the high occurrence of crimes affects the price on Airbnb in some neighborhoods. For example, neighborhoods that like Dorchester and Mattapan have lower prices. However, downtown has a more complicated situation that prices were distributed unevenly in this area. We need more information to find out what factors cause this situation.     
      
      
## Conclusion              
From the previous analysis, we can see that the number of bedrooms and the type of rooms affect the price on Airbnb. The score of satisfaction actually has little influence on price. Moreover, more crimes indeed affect prices in some neighborhoods. Nevertheless, other neighborhoods have different situations. The reasons that cause this problem perhaps are building quality, transportation, and so on. I will import more data to explore this project in the future.  


## Reference    
http://tomslee.net/airbnb-data-collection-get-the-data      

https://data.boston.gov/       
 





